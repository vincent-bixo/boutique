{"version":3,"file":"js/payment_mb.js","mappings":"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","sources":["webpack://paypal/./_dev/js/payment_mb.js"],"sourcesContent":["/**\n * 2007-2023 PayPal\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Academic Free License (AFL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http://opensource.org/licenses/afl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n *  versions in the future. If you wish to customize PrestaShop for your\n *  needs please refer to http://www.prestashop.com for more information.\n *\n *  @author 2007-2023 PayPal\n *  @author 202 ecommerce <tech@202-ecommerce.com>\n *  @license http://opensource.org/licenses/osl-3.0.php Open Software License (OSL 3.0)\n *  @copyright PayPal\n *\n */\n\nconst PayPalMB = {\n\n    ppp: null,\n\n    config: null,\n\n    paymentId: null,\n\n    setConfig(paymentInfo, selectorId) {\n        this.config = {\n            \"approvalUrl\": paymentInfo.approvalUrlPPP,\n            \"placeholder\": selectorId,\n            \"mode\": paymentInfo.paypalMode,\n            \"payerEmail\": paymentInfo.payerInfo.email,\n            \"payerFirstName\": paymentInfo.payerInfo.first_name,\n            \"payerLastName\": paymentInfo.payerInfo.last_name,\n            \"payerTaxId\": paymentInfo.payerInfo.tax_id,\n            \"payerTaxIdType\": paymentInfo.payerInfo.tax_id_type,\n            \"language\": paymentInfo.language,\n            \"country\": paymentInfo.country,\n            \"disallowRememberedCards\": paymentInfo.disallowRememberedCards,\n            \"rememberedCards\": paymentInfo.rememberedCards,\n            \"onError\": this.handleError,\n            \"merchantInstallmentSelectionOptional\": paymentInfo.merchantInstallmentSelectionOptional == 1,\n            \"merchantInstallmentSelection\": 1\n        };\n\n        this.paymentId = paymentInfo.paymentId;\n    },\n\n    initCheckout() {\n        this.setLoader(\"#ppplus-mb\");\n        this.getPaymentInfo().then(\n            paymentInformation => {\n                this.setConfig(paymentInformation, \"ppplus-mb\");\n\n                if (this.config.country == 'BR' && this.config.payerTaxId == '') {\n                    let message = typeof(EMPTY_TAX_ID) != 'undefined' ? EMPTY_TAX_ID : 'Payer tax id is empty';\n                    this.showMessage(message, '#ppplus-mb', 'danger');\n                    return;\n                }\n\n                this.ppp = PAYPAL.apps.PPP(this.config);\n            }\n        ).catch(error => {\n            console.log(error);\n        });\n    },\n\n    showMessage(message, selector, type) {\n        let messageContainer = $(`<div class=\"alert alert-${type}\" />`);\n        messageContainer.text(message);\n        $(selector).html(messageContainer);\n    },\n\n    setLoader(selector) {\n        let loader = '<div class=\"pp__flex pp__justify-content-center\"><div class=\"paypal-loader\"></div></div>';\n        $(selector).html(loader);\n    },\n\n    doPayment() {\n        if (this.ppp != null) {\n          this.ppp.doContinue();\n        }\n    },\n\n    getPaymentInfo() {\n        let promise = new Promise((resolve, reject) => {\n            $.ajax({\n                url: ajaxPatch,\n                type: \"POST\",\n                dataType: \"JSON\",\n                data: {\n                    ajax: true,\n                    action: 'getPaymentInfo',\n                },\n                before () {\n\n                },\n                success (response) {\n                    if ((\"success\" in response) && (response[\"success\"] == true)) {\n                        resolve(response.paymentInfo);\n                    }\n                }\n            });\n        });\n\n        return promise;\n    },\n\n    messageListener(event) {\n        try {\n            let data = JSON.parse(event.data);\n\n            if (data.action == \"checkout\" && data.result.state == \"APPROVED\") {\n                data['paymentId'] = PayPalMB.paymentId;\n                PayPalMB.sendData(data, ajaxPatch);\n            }\n        } catch (exc) {\n            console.log(exc);\n        }\n    },\n\n    handleError(error) {\n        if (typeof error.cause !== 'undefined') { //iFrame error handling\n\n            let ppplusError = error.cause.replace (/['\"]+/g,\"\"); //log & attach this error into the order if possible\n\n            // <<Insert Code Here>>\n\n            switch (ppplusError)\n\n            {\n\n                case \"INTERNAL_SERVICE_ERROR\": //javascript fallthrough\n                case \"SOCKET_HANG_UP\": //javascript fallthrough\n                case \"socket hang up\": //javascript fallthrough\n                case \"connect ECONNREFUSED\": //javascript fallthrough\n                case \"connect ETIMEDOUT\": //javascript fallthrough\n                case \"UNKNOWN_INTERNAL_ERROR\": //javascript fallthrough\n                case \"fiWalletLifecycle_unknown_error\": //javascript fallthrough\n                case \"Failed to decrypt term info\": //javascript fallthrough\n                case \"RESOURCE_NOT_FOUND\": //javascript fallthrough\n                case \"INTERNAL_SERVER_ERROR\":\n                    alert (\"Ocorreu um erro inesperado, por favor tente novamente. (\" + ppplusError + \")\"); //pt_BR\n                    //Generic error, inform the customer to try again; generate a new approval_url and reload the iFrame.\n                    // <<Insert Code Here>>\n                    break;\n\n                case \"RISK_N_DECLINE\": //javascript fallthrough\n                case \"NO_VALID_FUNDING_SOURCE_OR_RISK_REFUSED\": //javascript fallthrough\n                case \"TRY_ANOTHER_CARD\": //javascript fallthrough\n                case \"NO_VALID_FUNDING_INSTRUMENT\":\n                    alert (\"Seu pagamento não foi aprovado. Por favor utilize outro cartão, caso o problema persista entre em contato com o PayPal (0800-047-4482). (\" + ppplusError + \")\"); //pt_BR\n                    //Risk denial, inform the customer to try again; generate a new approval_url and reload the iFrame.\n                    // <<Insert Code Here>>\n                    break;\n\n                case \"CARD_ATTEMPT_INVALID\":\n                    alert (\"Ocorreu um erro inesperado, por favor tente novamente. (\" + ppplusError + \")\"); //pt_BR\n                    //03 maximum payment attempts with error, inform the customer to try again; generate a new approval_url and reload the iFrame.\n                    // <<Insert Code Here>>\n                    break;\n\n                case \"INVALID_OR_EXPIRED_TOKEN\":\n                    alert (\"A sua sessão expirou, por favor tente novamente. (\" + ppplusError + \")\"); //pt_BR\n                    //User session is expired, inform the customer to try again; generate a new approval_url and reload the iFrame.\n                    // <<Insert Code Here>>\n                    break;\n\n                case \"CHECK_ENTRY\":\n                    alert (\"Por favor revise os dados de Cartão de Crédito inseridos. (\" + ppplusError + \")\"); //pt_BR\n                    //Missing or invalid credit card information, inform your customer to check the inputs.\n                    // <<Insert Code Here>>\n                    break;\n\n                default:  //unknown error & reload payment flow\n                    alert (\"Ocorreu um erro inesperado, por favor tente novamente. (\" + ppplusError + \")\"); //pt_BR\n                //Generic error, inform the customer to try again; generate a new approval_url and reload the iFrame.\n                // <<Insert Code Here>>\n\n            }\n\n        }\n\n        console.log(error, typeof error);\n    },\n\n    sendData(data, action) {\n        let messageSuccess;\n\n        if (typeof(PAYMENT_SUCCESS) != 'undefined') {\n            messageSuccess = PAYMENT_SUCCESS;\n        } else {\n            messageSuccess = 'Payment successful! You will be redirected to the payment confirmation page in a couple of seconds.';\n        }\n\n        PayPalMB.showMessage(messageSuccess, '#ppplus-mb', 'success');\n        $('#ppplus-mb').css('height', '100%');\n        let form = document.createElement('form');\n        let input = document.createElement('input');\n\n        input.name = \"paymentData\";\n        input.value = JSON.stringify(data);\n\n        form.method = \"POST\";\n        form.action = action;\n\n        form.appendChild(input);\n        form.style = 'display: none';\n        document.body.appendChild(form);\n        form.submit();\n    }\n\n}\n\n\n$(document).ready(() => {\n    $('.payment-options input[name=\"payment-option\"]').click((event) => {\n        let paymentOption = $(event.target);\n        if (paymentOption.attr('data-module-name') == \"paypal_plus_mb\") {\n            PayPalMB.initCheckout();\n        }\n\n        prestashop.on(\"updatedCart\", () => {\n            PayPalMB.initCheckout();\n        });\n    });\n\n    // Order payment button action for paypal plus\n    $('#payment-confirmation button').on('click', (event) => {\n        let selectedOption = $('input[name=payment-option]:checked');\n        if (selectedOption.attr(\"data-module-name\") == \"paypal_plus_mb\") {\n            event.preventDefault();\n            event.stopPropagation();\n            PayPalMB.doPayment();\n        }\n    });\n\n    if (window.addEventListener) {\n        window.addEventListener(\"message\", PayPalMB.messageListener, false);\n    } else if (window.attachEvent) {\n        window.attachEvent(\"onmessage\", PayPalMB.messageListener);\n    } else {\n        throw new Error(\"Can't attach message listener\");\n    }\n});\n"],"names":["PayPalMB","ppp","config","paymentId","setConfig","paymentInfo","selectorId","this","approvalUrlPPP","paypalMode","payerInfo","email","first_name","last_name","tax_id","tax_id_type","language","country","disallowRememberedCards","rememberedCards","handleError","merchantInstallmentSelectionOptional","initCheckout","_this","setLoader","getPaymentInfo","then","paymentInformation","payerTaxId","PAYPAL","apps","PPP","message","EMPTY_TAX_ID","showMessage","error","selector","type","messageContainer","$","concat","text","html","doPayment","doContinue","Promise","resolve","reject","ajax","url","ajaxPatch","dataType","data","action","before","success","response","messageListener","event","JSON","parse","result","state","sendData","exc","cause","ppplusError","replace","alert","_typeof","messageSuccess","PAYMENT_SUCCESS","css","form","document","createElement","input","name","value","stringify","method","appendChild","style","body","submit","ready","click","target","attr","prestashop","on","preventDefault","stopPropagation","window","addEventListener","attachEvent","Error"],"sourceRoot":""}