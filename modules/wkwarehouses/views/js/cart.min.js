/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function checkPassingCheckout(){$(".pass-restriction-info").length>0||"undefined"!=typeof warehouses_restrictions&&warehouses_restrictions?("undefined"!=typeof warehouses_restrictions&&warehouses_restrictions&&$(".cart-grid").prepend('<div class="alert alert-warning pass-warehouses-restriction-cart">'+txt_multi_warehouses_not_allowed+"</div>"),$(".cart-detailed-actions button, .cart-detailed-actions a").addClass("disabled")):$(".cart-detailed-actions button, .cart-detailed-actions a").removeClass("disabled")}function applyCssOnDeliveryAddressBlock(){$("#delivery-address-cart").length>0&&($(".card").length>0?($("#delivery-address-cart").addClass("card"),$("#delivery-address-cart").css({"margin-top":"1rem"})):$("#delivery-address-cart").css({"margin-top":"1rem",padding:"0.3rem 1rem 1rem 1rem","box-shadow":"2px 2px 8px 0 rgba(0, 0, 0, .2)",background:"#FFF"}))}function onUpdateCartModuleActions(){return $.ajax({url:process_cart_url,type:"POST",dataType:"json",data:{ajax:!0,action:"refreshWarehouseCart"},beforeSend:function(){warehouses_in_cart&&$(".warehouse-info").css("opacity","0.4"),deliver_address_incart&&$("#delivery-address-cart").css("opacity","0.4")},success:function(e){warehouses_in_cart&&($(".warehouse-info").css("opacity","14"),loadWarehousesDetails(e.warehouses_cart_details,!1)),deliver_address_incart&&($("#delivery-address-cart").css("opacity","1"),""==e.delivery_address&&$("#delivery-address-cart").hide()),void 0!==e.carriers_restrictions&&loadCarriersWarehousesRestrictionsInCart(e.carriers_restrictions,!1),void 0===e.warehouses_restrictions?($(".pass-warehouses-restriction-cart").remove(),$(".cart-detailed-actions button, .cart-detailed-actions a").removeClass("disabled")):checkPassingCheckout()}}),!1}function loadCarriersWarehousesRestrictionsInCart(e,r){var t=".cart-overview";r&&(e=JSON.parse(e)),$(t).length>0&&($.each($(t+" .cart-item"),function(e,r){$(r).find(".pass-restriction-info").remove(),$(r).css("border-bottom","1px solid #f2f2f2")}),$.each($(t+" .cart-item"),function(r,t){var a,i,s,o;$(t).find(".remove-from-cart").length>0&&(i=(a=$(t).find(".remove-from-cart")).data("id-product"),s=a.data("id-product-attribute")),void 0!==i&&void 0!==s&&$(t).find(".product-line-grid-body").length>0&&void 0!==e[i+"_"+s]&&(o='<div class="alert alert-warning pass-restriction-info" style="padding:5px; margin-bottom:0">',o+="undefined"!=typeof undelivered_product_txt?undelivered_product_txt:"This product can not be delivered!",o+="</div>",$("<br />"+o).appendTo($(t)))}))}function loadWarehousesDetails(e,r){var t=".cart-overview";r&&(e=JSON.parse(e)),$(t).length>0&&($.each($(t+" .cart-item"),function(e,r){$(r).find(".warehouse-info").remove(),$(r).css("border-bottom","1px solid #f2f2f2")}),$.each($(t+" .cart-item"),function(r,t){var a,i,s,o,d,n;$(t).find(".remove-from-cart").length>0&&(i=(a=$(t).find(".remove-from-cart")).data("id-product"),s=a.data("id-product-attribute")),void 0!==i&&void 0!==s&&$(t).find(".product-line-grid").length>0&&void 0!==(o=e[i+"_"+s])&&(d=new Array,display_warehouse_name&&o.name&&d.push("<strong>"+o.name+"</strong>"),display_warehouse_location&&o.location&&d.push((display_warehouse_name?"":"<strong>")+item_location_txt+(display_warehouse_name?"":"</strong>")+" "+o.location),display_country&&o.country&&d.push(o.country),display_warehouse_quantity&&d.push((o.quantity>0?parseInt(o.quantity):0)+" "+item_instock_txt),display_delivery_time&&o.delivery_time&&d.push(o.delivery_time),d.length>0&&(n="belowProductName"==position_cart?"":"<br />",n+='<div class="alert alert-info warehouse-info" style="padding:5px; margin-bottom:0">',n+=d.join("<br />"),n+="</div>","belowProductName"==position_cart&&($(t).find(".product-line__body").length>0?body_container=".product-line__body":body_container=".product-line-grid-body"),$(n).appendTo("undefined"!=typeof body_container?$(t).find(body_container):$(t))))}))}$(document).ready(function(){prestashop.on("updatedCart",function(e){onUpdateCartModuleActions(),"undefined"!=typeof carriers_restrictions&&loadCarriersWarehousesRestrictionsInCart(carriers_restrictions,!0),checkPassingCheckout()}),applyCssOnDeliveryAddressBlock(),"undefined"!=typeof carriers_restrictions&&loadCarriersWarehousesRestrictionsInCart(carriers_restrictions,!0),checkPassingCheckout()});
