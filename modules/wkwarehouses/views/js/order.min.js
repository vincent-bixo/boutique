/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function printCarrierLines(e){var t,i,r;if(e.length>0){if($(".no-carrier-alert").remove(),"undefined"!=typeof delivery_option_list&&0!=delivery_option_list.length){for(k in e.empty(),t="",delivery_option_list)for(key in i=!1,id_address=k,package=delivery_option_list[k],t+='<div class="row multi-shipping-row" style="background-color:#555; color:#FFF; padding:3px">',void 0!==address_collection[id_address]&&address_collection[id_address]?t+=txt_choose_shipping_adress+" "+address_collection[id_address].alias:t+=txt_choose_shipping,t+="</div>",t+='<div class="clearfix"></div>',package){if(carrier_id=key,carrier=package[key],t+='<div class="row delivery-option">',t+='\t<div class="col-sm-1">',t+='\t\t<span class="custom-radio float-xs-left">',t+='\t\t\t<input type="radio" '+("undefined"!=typeof OnePageCheckoutPS?'class="delivery_option_radio"':"")+' name="delivery_option['+id_address+']" id="delivery_option_'+carrier_id+'" value="'+carrier_id+'"'+(carrier.selected?" checked":"")+">",t+="\t\t\t<span></span>",t+="\t\t</span>",t+="\t</div>",t+='\t<label for="delivery_option_'+carrier_id+'" class="col-sm-11 delivery-option-2">',t+='\t\t<div class="row'+(void 0!==carrier.carriers_table?" col-xs-9":"")+'">',r="",void 0!==carrier.carriers_table)for(index in i=!0,carrier.carriers_table)""!=carrier.carriers_table[index].extraContent&&(r+='<div class="col-sm-12" style="border: 1px solid antiquewhite; padding: 5px; margin-bottom:20px">'+carrier.carriers_table[index].extraContent+"</div>"),t+=renderMultiCarriersLine(carrier.carriers_table[index],i),index!=carrier.carriers_table.length-1&&(t+='<hr class="col-sm-11"/>');else t+=renderMultiCarriersLine(carrier);i&&(t+="\t</div>"),t+='\t\t\t<div class="col-sm-3 col-xs-12 totalShippingPrice">',t+='\t\t\t\t<span class="carrier-price">'+carrier.price+"</span>",t+="\t\t\t</div>",t+="\t\t</div>",t+="\t</label>",t+="</div>",t+='<div class="row carrier-extra-content" style="'+(carrier_id!=delivery_option?"display:none;":"")+(""!=r?"margin-left: 20px; margin-right: 0px;":"")+'">',t+=""!=r&&i?r:carrier.extraContent,t+="</div>",t+='<div class="clearfix"></div>'}e.html(t),i&&fixDeliveryOptionsMarginTop()}else e.html(""),$('<div class="alert alert-warning no-carrier-alert">'+txt_no_carrier+"</div>").insertBefore(".delivery-options-list form .continue");$(document).on("click","#checkout-delivery-step .step-title",function(e){$("#checkout-delivery-step").find(".content").is(":visible")&&fixDeliveryOptionsMarginTop()})}}function fixDeliveryOptionsMarginTop(e){$(".delivery-options .delivery-option").each(function(t){e=$(this).height()/2-11,console.log(e),$(this).find("label .totalShippingPrice").css({"margin-top":e+"px","text-align":"right"})})}function passToCarriersStep(){var e=!0;return $("#checkout-addresses-step .js-address-form .delivery-addresses-table").length&&$("#checkout-addresses-step .delivery-addresses-table .cart_address_delivery").each(function(t){""!=$(this).val()&&null!=$(this).val()||(e=!1)}),e}function renderMultiCarriersLine(e,t){return shipping_line='\t\t<div class="col-sm-'+(void 0!==t&&t?"8":"5")+' col-xs-12">',shipping_line+='\t\t<div class="row carrier '+(e.logo?"carrier-hasLogo":"")+'">',null!=e.logo&&0!=e.logo&&e.logo&&(shipping_line+='\t\t<div class="col-xs-12 col-md-3 carrier-logo" '+("undefined"!=typeof OnePageCheckoutPS?'style="padding: 0;"':"")+">",shipping_line+='\t\t\t<img src="'+e.logo+'" alt="'+(e.name?e.name:"")+'"/>',shipping_line+="\t\t</div>"),shipping_line+='\t\t\t<div class="col-xs-12 carriere-name-container'+(e.logo?" col-md-9":"")+'">',shipping_line+='\t\t\t\t<span class="h6 carrier-name">'+e.name+(e.warehouse_name?"<br><small>"+e.warehouse_name+"</small>":"")+"</span>",shipping_line+="\t\t\t</div>",shipping_line+="\t\t</div>",shipping_line+="\t</div>",shipping_line+='\t<div class="col-sm-4 col-xs-12">',shipping_line+='\t\t<span class="carrier-delay">'+e.delay+"</span>",shipping_line+="\t</div>",shipping_line}function fancyCloseBox(e,t){var i='<p style="text-align:right; padding-bottom: 0" class="submit">';i+='<input type="button" onclick="$.fancybox.close();" value="'+txt_ok+'" class="button btn btn-danger">',i+="</p>",$.fancybox('<div class="alert alert-'+t+'">'+e+"</div>"+i)}function arrayUnique(e){var t=[];return $.each(e,function(e,i){-1==$.inArray(i,t)&&t.push(i)}),t}$(document).ready(function(){function printMultiCarriersChoiceLines(e){var t,i,r;if(e.length>0){if($(".no-carrier-alert").remove(),"undefined"!=typeof delivery_option_list&&0!=delivery_option_list.length){for(id_address in e.empty(),t="",delivery_option_list)for(id_warehouse_key in t+='\t<input type="hidden" name="delivery_option['+id_address+']" id="all_carriers_delivery_option" value="'+("undefined"!=typeof delivery_option&&delivery_option?delivery_option:"")+'" checked>',delivery_option_list[id_address])for(key in t+='<div class="row multi-shipping-row" style="background-color:#555; color:#FFF; padding:3px">',i=parseInt(id_warehouse_key.substring(0,id_warehouse_key.length-1)),void 0!==warehouses_names[i]&&warehouses_names[i]?t+=warehouses_names[i]:t+=i?txt_warehouse:txt_products_not_asm,t+="</div>",t+='<div class="clearfix"></div>',delivery_option_list[id_address][id_warehouse_key])for(carrier_id in warehouse_carriers=delivery_option_list[id_address][id_warehouse_key][key].carrier_list,warehouse_carriers)carrier=warehouse_carriers[carrier_id],t+='<div class="row delivery-option js-delivery-option">',t+='\t<div class="col-sm-1 carrier_div">',t+='\t\t<span class="custom-radio float-xs-left">',t+='\t\t\t<input type="radio" class="delivery_option_radio" data-delivery-option-list-k="delivery_option['+id_address+']" data-id-carrier="'+carrier_id+'" name="my_delivery_option['+i+']" id="delivery_option_'+carrier_id+'" value="'+carrier_id+',"'+(carrier.selected?" checked":"")+">",t+="\t\t\t<span></span>",t+="\t\t</span>",t+="\t</div>",t+='\t<label for="delivery_option_'+carrier_id+'" class="col-xs-9 col-sm-11 delivery-option-2">',t+='\t\t<div class="row'+(""!=carrier.extraContent?" col-xs-8":"")+'">',r="",""!=carrier.extraContent&&(r='<div class="col-sm-12" style="border: 1px solid antiquewhite; padding: 5px; margin-bottom:20px">'+carrier.extraContent+"</div>"),t+=displayCarrierLine(carrier),t+="\t\t</div>",t+="\t</label>",t+="</div>",t+='<div class="row carrier-extra-content js-carrier-extra-content" style="'+(carrier_id!=delivery_option?"display:none;":"")+(""!=r?"margin-left: 20px; margin-right: 0px;":"")+'">',t+=r,t+="</div>",t+='<div class="clearfix"></div>';e.html(t)}else e.html(""),$('<div class="alert alert-warning no-carrier-alert">'+txt_no_carrier+"</div>").insertBefore(".delivery-options-list form .continue");$(document).on("click","#checkout-delivery-step .step-title",function(e){$("#checkout-delivery-step").find(".content").is(":visible")&&fixDeliveryOptionsMarginTop()})}}function displayCarrierLine(e){return shipping_line='\t\t<div class="col-sm-5 col-xs-12">',shipping_line+='\t\t<div class="row carrier'+(e.logo?" carrier-hasLogo":"")+'">',null!=e.logo&&0!=e.logo&&e.logo&&(shipping_line+='\t\t<div class="col-xs-12 col-md-3 carrier-logo" '+("undefined"!=typeof OnePageCheckoutPS?'style="padding: 0;"':"")+">",shipping_line+='\t\t\t<img src="'+e.logo+'" alt="'+(e.name?e.name:"")+'"/>',shipping_line+="\t\t</div>"),shipping_line+='\t\t\t<div class="col-xs-12 carriere-name-container'+(e.logo?" col-md-9":"")+'">',shipping_line+='\t\t\t\t<span class="h6 carrier-name">'+e.name+"</span>",shipping_line+="\t\t\t</div>",shipping_line+="\t\t</div>",shipping_line+="\t</div>",shipping_line+='\t<div class="col-sm-4 col-xs-12"><span class="carrier-delay">'+e.delay+"</span></div>",shipping_line+='\t<div class="col-sm-3 col-xs-12"><span class="carrier-price">'+e.price+"</span></div>",shipping_line}if($("#delivery-addresses").length>0&&$("div.js-address-form form").length>0&&"undefined"!=typeof cart_collection&&cart_collection.length>0){$addressesContainer=$("#delivery-addresses"),$addressesContainer.parent().find("h2").first().html(txt_delivery_addresses),$.each($addressesContainer,function(e,t){$address_item=$(t).find(".address-item"),$address_item.length>0&&($address_item.removeClass("selected"),$address_item.find("input[type=radio][name='id_address_delivery']").parent().replaceWith(""))}),material_icon_style='style="font-size:1.2em"',cart_html='<h2 class="h4">'+txt_choose_addresses+"</h2>",cart_html+='<div class="delivery-addresses-table">',cart_html+='  <ul class="cart-items" style="margin-bottom: 15px; background-color:#f6f6f6">';for(var e=0;e<cart_collection.length;e++){for(k in cartLine=cart_collection[e],cart_html+='<li class="cart-item" style="border-bottom:1px solid #ddd; box-shadow: 0px 1px #FFFFFF;">',cart_html+='<div class="product-line-grid">',cart_html+='<div class="product-line-grid-left col-md-3 col-xs-4">',cart_html+='\t<span class="product-image media-middle">',cart_html+='\t\t<img src="'+cartLine.image+'" alt="'+cartLine.name+'">',cart_html+="\t</span>",cart_html+="</div>",cart_html+='<div class="product-line-grid-body col-md-5 col-xs-8">',cart_html+='\t<div class="product-line-info">',cart_html+='\t\t<a class="label" href="'+cartLine.url+'">'+cartLine.name+"</a>",cart_html+="\t</div>",cart_html+='\t<div class="product-line-info product-price h5'+(cartLine.has_discount?" has-discount":"")+'">',cartLine.has_discount&&(cart_html+='\t<div class="product-discount">',cart_html+='\t\t<span class="regular-price">'+cartLine.regular_price+"</span>","percentage"===cartLine.discount_type?(cart_html+='\t<span class="discount discount-percentage">',cart_html+="\t\t-"+cartLine.discount_percentage_absolute,cart_html+="\t</span>"):(cart_html+='\t<span class="discount discount-amount">',cart_html+="\t\t-"+cartLine.discount_to_display,cart_html+="\t</span>"),cart_html+="\t</div>"),cart_html+='\t\t<div class="current-price">',cart_html+='\t\t\t<span class="price">'+cartLine.price+"</span>",cartLine.unit_price_full&&(cart_html+='\t\t<div class="unit-price-cart">'+cartLine.unit_price_full+"</div>"),cart_html+="\t\t</div>",cart_html+="\t</div>",cartLine.attributes.length>0&&(cart_html+="<br/>",cart_html+="<small>"+cartLine.attributes.join("; ")+"</small>"),void 0!==cartLine.warehouse_name&&""!=cartLine.warehouse_name&&(cart_html+="<br/>",cart_html+="<small><strong>"+txt_warehouse+":</strong> "+cartLine.warehouse_name,void 0!==cartLine.warehouse_country_name&&""!=cartLine.warehouse_country_name&&0!=cartLine.address_list.length&&(cart_html+=" ("+cartLine.warehouse_country_name+")"),cart_html+="</small>"),cart_html+="\t</div>",cart_html+='\t<div class="product-line-grid-right product-line-actions col-md-4 col-xs-12">',cart_html+='\t\t<div class="row">',cart_html+='\t\t\t<div class="col-xs-4 hidden-md-up"></div>',cart_html+='\t\t\t<div class="col-md-12 text-xs-right">',cart_html+='\t\t\t\t<select id="select_address_delivery_'+cartLine.id_product+"_"+cartLine.id_product_attribute+"_"+cartLine.id_address_delivery+"_"+cartLine.id_warehouse+'" ',cart_html+='\t\t\t\tclass="form-control form-control-select cart_address_delivery">',0==cartLine.id_address_delivery&&"undefined"!=typeof delivery_cart_id&&0==delivery_cart_id&&(cart_html+="\t\t\t\t<option></option>"),cartLine.address_list)id_address=parseInt(cartLine.address_list[k].id_address),cart_html+='\t\t\t\t<option value="'+id_address+'" '+(cartLine.address_list[k].selected?' selected="selected"':"")+">"+cartLine.address_list[k].alias,cart_html+="\t\t\t\t</option>";cart_html+="\t\t\t\t</select>",0==cartLine.address_list.length&&(cart_html+="<br />"+($(".add-address").length>0?"<small>"+$(".add-address").html().replace('class="material-icons"','class="material-icons" '+material_icon_style)+"</small>":""),cartLine.best_zone,cartLine.best_zone&&(delivery_countries="<strong>"+txt_delivery_where+"</strong><br />"+cartLine.best_zone,cart_html+='<br /><small><a href="javascript:void(0)" onclick="fancyCloseBox(delivery_countries, \'success\');">',cart_html+='<i class="material-icons" '+material_icon_style+">&#xE145;</i> "+txt_countries_zone,cart_html+="</a></small>"),void 0!==cartLine.warehouse_country_name&&""!=cartLine.warehouse_country_name&&(cart_html+="<br /><small><strong>"+txt_country_zone+"</strong>: "+cartLine.warehouse_country_name+"</small>")),cart_html+="\t\t\t</div>",cart_html+="\t\t</div>",cart_html+="\t</div>",cart_html+='\t<div class="clearfix"></div>',cart_html+="</div>",cart_html+="</li>"}cart_html+="  </ul>",cart_html+="</div>",$("div.js-address-form form").prepend(cart_html)}if($(document).on("change",".cart_address_delivery",function(e){var t,i,r,s,a,n;obj=$(this),t=obj.attr("id").split("_"),i=t[3],r=t[4],s=t[5],a=obj.val(),n=t[6],a!=s&&a>0&&$.ajax({url:cart_wkwarehouses_url,type:"POST",headers:{"cache-control":"no-cache"},async:!0,cache:!1,dataType:"json",data:{ajax:!0,action:"changeAddressDelivery",id_product:i,id_product_attribute:r,id_warehouse:n,old_id_address_delivery:s,new_id_address_delivery:a},success:function(e){void 0!==e.hasErrors&&e.hasErrors?(fancyCloseBox(e.error,"danger"),$("#select_address_delivery_"+i+"_"+r+"_"+s+"_"+n).val(s)):obj.attr("id","select_address_delivery_"+i+"_"+r+"_"+a+"_"+n)}})}),$(document).on("click","#checkout-addresses-step form .continue",function(e){if(!passToCarriersStep())return fancyCloseBox(txt_incomplete_addresses,"danger"),!1}),passToCarriersStep()||($("#checkout-addresses-step").removeClass("-complete"),$("#checkout-addresses-step .content").show(),$(".delivery-options-list form .continue").attr("disabled",!0),$("#checkout-delivery-step").addClass("checkout-step -reachable -clickable -unreachable"),$("#checkout-delivery-step .step-title").addClass("not-allowed"),$("#checkout-delivery-step .content").css("display","none"),$("#checkout-payment-step").addClass("checkout-step -reachable -clickable -unreachable"),$("#checkout-payment-step .step-title").addClass("not-allowed"),$("#checkout-payment-step .content").css("display","none")),"undefined"==typeof OnePageCheckoutPS?"carriers-warehouses"==mode_multi_carriers_choice?printMultiCarriersChoiceLines($(".delivery-options-list .delivery-options")):printCarrierLines($(".delivery-options-list .delivery-options")):$(document).on("opc-load-carrier:completed",function(){"carriers-warehouses"==mode_multi_carriers_choice?printMultiCarriersChoiceLines(AppOPC.$opc_step_two.find(".delivery-options")):printCarrierLines(AppOPC.$opc_step_two.find(".delivery-options"))}),$.each($("#js-delivery input.delivery_option_radio"),function(e,t){$(this).unbind("change"),$(this).unbind("click")}),$(document).on("click","input.delivery_option_radio",function(e){var t,i,r="",s={};$.each($("input.delivery_option_radio:checked"),function(e,i){if(void 0!==$(this).attr("data-id-carrier")){""==r&&(t=$(this).attr("data-delivery-option-list-k"));var a=parseInt($(this).attr("data-id-carrier"));s[a]={},r+=a+","}}),i=t+"="+r,$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:$("#js-delivery").data("url-update")+"&rand="+(new Date).getTime(),async:!1,cache:!1,dataType:"json",data:i,success:function(e){$("#all_carriers_delivery_option").val(r),setTimeout(function(){$("#js-checkout-summary").replaceWith(e.preview)},600)},error:function(e){console.log(e)}})}),summary_element="#order-summary-content .summary-selected-carrier",$(summary_element).length>0&&"undefined"!=typeof methods_shipping_collection){for(k in shipping_methods_html="",padding_css=$(summary_element).css("padding-top"),"undefined"==typeof padding_css&&(padding_css="undefined"!==$(summary_element).css("padding-bottom")?$(summary_element).css("padding-bottom"):"16px"),methods_shipping_collection)carrier_collection=methods_shipping_collection[k],shipping_methods_html+='<div class="row" style="'+(k!=methods_shipping_collection.length-1?"border-bottom: 1px solid #e5e5e5; padding-bottom:"+padding_css:"padding-top:"+padding_css)+'">',shipping_methods_html+='  <div class="col-md-2">',shipping_methods_html+='\t<div class="logo-container">',carrier_collection.logo?shipping_methods_html+='\t\t<img src="'+carrier_collection.logo+'" alt="'+carrier_collection.name+'">':shipping_methods_html+="\t\t&nbsp;",shipping_methods_html+="\t</div>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-4">',shipping_methods_html+='\t<span class="carrier-name">'+carrier_collection.name+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-4">',shipping_methods_html+='\t<span class="carrier-delay">'+carrier_collection.delay+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-2">',shipping_methods_html+='\t<span class="carrier-price">'+carrier_collection.price+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+="</div>";shipping_methods_html&&$(summary_element).html(shipping_methods_html)}$(document).on("click",".delivery-options-list form .continue",function(e){var t,i,r;if(!$(".delivery-options-list .multi-shipping-row").length)return fancyCloseBox(txt_no_carrier,"danger"),!1;if(t=!0,delivery_radios_options=$(".delivery-options input[type=radio][name^='delivery_option']"),delivery_radios_options.length&&(i=delivery_radios_options.map(function(){return this.name.match(/\d+/)}).get()).length)for(i=arrayUnique(i),r=0;r<i.length;r++)if(0==$(".delivery-options input[type=radio][name^='delivery_option["+parseInt(i[r])+"]']:checked").length){t=!1;break}return t?void 0:(fancyCloseBox(txt_incomplete_addresses,"danger"),!1)})});
