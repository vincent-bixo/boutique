/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function resetAsmStock(){var e,t,s="",o=!1;return void 0!==productFilterTable&&(o=productFilterTable.rows({selected:!0}).count()),o||(s+='<i class="icon-check"></i> '+trans.txt_select_product+" "+trans.txt_left_panel+"<br />"),""!=s?(showErrorMessage(s),!1):(e=$("#id_warehouse").val(),t=trans.msg_reset_stock,$("input[id=transfer_qty_off]").attr("checked",!0),$("input[id=move_off]").attr("checked",!0),data_post="action=beginProcess&process=reinitiateStock&"+getCheckedProductsLeft(productFilterTable),isNaN(e)||""==e||(data_post+="&id_warehouse="+parseInt(e),t+=" ("+trans.for_warehouse+' "<strong>'+$('#id_warehouse option[value="'+e+'"]').text()+'</strong>")'),t+="<br /><br /><strong>"+trans.msg_confirm+"</strong>",$("#openmsgbox").html(t).dialog({resizable:!1,title:trans.txt_confirm,autoheight:!0,width:450,modal:!0,closeOnEscape:!1,buttons:[{text:"OK",click:function(){return $(this).dialog("close"),processNow(0,5,-1,!0),!1}},{text:trans.txt_cancel,click:function(){$(this).dialog("close")}}]}),!1)}function associateItems(){var e,t,s,o,r="",a=!1;if(void 0!==productFilterTable&&(a=productFilterTable.rows({selected:!0}).count()),a||(r+='<i class="icon-check"></i> '+trans.txt_select_product+" "+trans.txt_left_panel+"<br />"),""!=(e=$("#ids_target").chosen().val())&&null!=e||(r+='<i class="icon-check"></i> '+trans.txt_target_mandatory+"<br />"),$("#id_warehouse").length>0&&(t=$("#id_warehouse").val(),s=$("#transfer_qty_on").is(":checked")?1:0,$("#transfer_qty_on").is(":disabled")&&(s=0),o=$("#move_on").is(":checked")?1:0,$("#move_on").is(":disabled")&&(o=0),(!isNaN(t)&&o||s&&isNaN(t))&&null!=e&&(e.length>1||-1!==$.inArray("ALL",e))&&(r+='<i class="icon-check"></i> '+trans.txt_onlyone_warehouse+" "+trans.txt_right_panel+"<br />")),""!=r)return showErrorMessage(r),!1;a&&(data_post="action=beginProcess&process=associateWarehouses&ids_target="+e,$("#id_warehouse").length>0&&(data_post+="&transfer_qty="+s+"&move_on="+o,"normal_stock"==t||"without_warehouses"==t?$("#openmsgbox").html(trans.txt_convert_depends_on_stock).dialog({resizable:!1,title:trans.txt_confirm,autoheight:!0,width:500,modal:!0,closeOnEscape:!1,buttons:[{text:"OK",click:function(){data_post+="&turn_on_depends_on_stock=1","normal_stock"!=t&&"without_warehouses"!=t||(data_post+="&turn_on_asm=1"),doAssignments(data_post),$(this).dialog("close")}},{text:trans.txt_no,click:function(){doAssignments(data_post),$(this).dialog("close")}},{text:trans.txt_cancel,click:function(){$(this).dialog("close")}}]}):doAssignments(data_post+="&id_warehouse_from="+t)))}function doAssignments(e){return data_post=e+"&"+getCheckedProductsLeft(productFilterTable),processNow(0,5,-1,!0),!1}function processNow(e,t,s,o){0==e&&o&&updateProgressionInit(),0!=e||o||updateProgression(0,s,t,!1,null);var r=(new Date).getTime();$.ajax({type:"POST",url:url_global+"&ajax=1&offset="+e+"&limit="+t+(o?"&validateBefore=1":""),cache:!1,dataType:"json",data:data_post,success:function(a){var i,n,l,d,c,u,p;if(a.totalCount&&(s=a.totalCount),a.informations&&a.informations.length>0&&updateValidationInfo("<li>"+a.informations.join("</li><li>")+"</li>"),a.warnings&&a.warnings.length>0&&(o?updateValidationError("<li>"+a.warnings.join("</li><li>")+"</li>",!0):updateProgressionError("<li>"+a.warnings.join("</li><li>")+"</li>",!0)),a.errors&&a.errors.length>0)o?updateValidationError("<li>"+a.errors.join("</li><li>")+"</li>",!1):updateProgressionError("<li>"+a.errors.join("</li><li>")+"</li>",!1);else if(1==!a.isFinished){if(i=(new Date).getTime()-r,n=5e3,l=Math.min(4,n/i),d=Math.min(100,Math.max(5,Math.floor(t*l))),c=e+t,o?updateValidation(a.doneCount,s,a.doneCount+d):updateProgression(a.doneCount,s,a.doneCount+d,!1),1==importCancelRequest)return $("#processProgress").modal("hide"),importCancelRequest=!1,void refreshDatatables();processNow(c,d,s,o),a.nextPostSize>=.9*a.postSizeLimit&&(u=100*a.doneCount/s,p=Math.max(7,parseInt(a.postSizeLimit/(1024*u*1024)))+1,$("#import_details_post_limit_value").html(p+" MB"),$("#import_details_post_limit").show())}else o?(updateValidation(s,s,s),$("#import_details_warning").is(":visible")?(importContinueRequest=!0,$("#import_continue_button").show()):($("#import_progress_div").show(),processNow(0,5,s,!1))):(updateProgression(s,s,s,!0),refreshDatatables())},error:function(e,t,s){"parsererror"==t&&(t="Technical error: Unexpected response returned by server. Import stopped."),o?updateValidationError(t,!1):updateProgressionError(t,!1)}})}function refreshDatatables(){void 0!==productFilterTable&&productFilterTable.draw(!1),void 0!==productsFromWarehouses&&productsFromWarehouses.draw(!1)}function getCheckedProductsLeft(e){return chk_products=new Array,void 0!==e&&(e.rows({selected:!0}).ids().toArray().map(function(e,t){chk_products.push("chk_products[]="+e)}),chk_products.length>0&&(chk_products=chk_products.join("&"))),chk_products}function countTargetIDs(e){var t;return count_ids_split=0,""!=e&&(t=('"'+e+'"').split(","),count_ids_split=t.length),count_ids_split}function doSearch(){$("#id_warehouse").length>0&&(id_warehouse=$("#id_warehouse").val(),$("input[id=transfer_qty_off]").attr("checked",!0),$("input[id=move_off]").attr("checked",!0),isNaN(id_warehouse)&&""!=id_warehouse?$("input[type=radio][name=transfer_qty]").removeAttr("disabled"):$("input[type=radio][name=transfer_qty]").attr("disabled","disabled"),isNaN(id_warehouse)||""==id_warehouse?$("input[type=radio][name=move]").attr("disabled","disabled"):($("input[type=radio][name=move]").removeAttr("disabled"),$("input[id=move_off]").attr("checked",!0))),void 0!==productFilterTable&&productFilterTable.draw(!1)}function removeAssociations(){var e=!1;if(void 0!==productsFromWarehouses&&(e=productsFromWarehouses.rows({selected:!0}).count()),!e)return showErrorMessage(trans.txt_select_product+" "+trans.txt_right_panel),!1;$("#openmsgbox").html(trans.msg_remove_assign+"<br /><strong>"+trans.msg_confirm+"</strong>").dialog({resizable:!1,title:trans.txt_confirm,autoheight:!0,width:400,modal:!0,closeOnEscape:!1,buttons:[{text:"OK",click:function(){return $(this).dialog("close"),data_post="action=beginProcess&process=removeAssociations&"+getCheckedProductsLeft(productsFromWarehouses)+"&ids_target="+$("#ids_target").chosen().val(),processNow(0,5,-1,!0),!1}},{text:trans.txt_cancel,click:function(){$(this).dialog("close")}}]})}function refreshLeftPanel(){$(".leftPanel .panel-search select, .leftPanel .panel-search input").val("").trigger("chosen:updated").trigger("liszt:updated"),$("#transfer_qty_off").length>0&&($("input[id=transfer_qty_off]").attr("checked",!0),$("input[id=move_off]").attr("checked",!0),$("input[name=move]").attr("disabled",!0),$("input[name=transfer_qty]").attr("disabled",!0)),$("#ids_attributes").length>0&&$("#ids_attributes").val("").trigger("chosen:updated").trigger("liszt:updated"),void 0!==productFilterTable&&productFilterTable.page.len(20).search("").draw()}function refreshRightPanel(){return $(".multiple-select-chosen select").val("").trigger("chosen:updated").trigger("liszt:updated"),$("#id_brand").val("").trigger("chosen:updated").trigger("liszt:updated"),$("input[id=use_asm_off]").attr("checked",!0),void 0!==productsFromWarehouses&&productsFromWarehouses.page.len(20).search("").draw(),!1}function updateProgressionInit(){$("#processProgress").modal({backdrop:"static",keyboard:!1,closable:!1}),$("#processProgress").modal("show"),$("#processProgress").on("hidden.bs.modal",function(){$("#import_progressbar_done2").width("0%"),$("#import_progressbar_done2 span").html("0%")}),$("#import_details_progressing").show(),$("#import_details_finished").hide(),$("#import_details_error").hide(),$("#import_details_warning, #import_details_info").hide(),$("#import_details_stop").hide(),$("#import_details_post_limit").hide(),$("#import_details_error ul").html(""),$("#import_details_warning ul, #import_details_info ul").html(""),$("#import_validation_details").html($("#import_validation_details").attr("default-value")),$("#validate_progressbar_done").width("0%"),$("#validate_progressbar_done").parent().addClass("active progress-striped"),$("#validate_progression_done").html("0"),$("#validate_progressbar_done2").width("0%"),$("#validate_progressbar_next").width("0%"),$("#validate_progressbar_next").removeClass("progress-bar-danger"),$("#validate_progressbar_next").addClass("progress-bar-info"),$("#import_progress_div").hide(),$("#import_progression_details").html($("#import_progression_details").attr("default-value")),$("#import_progressbar_done").width("0%"),$("#import_progressbar_done").parent().addClass("active progress-striped"),$("#import_progression_done").html("0"),$("#import_progressbar_next").width("0%"),$("#import_progressbar_next").removeClass("progress-bar-danger"),$("#import_progressbar_next").addClass("progress-bar-success"),$("#import_stop_button").show(),$("#process_close_button").hide(),$("#import_continue_button").hide()}function updateValidation(e,t,s){var o,r;e>t&&(e=t),s>t&&(s=t),o=100*e/t,r=100*s/t,t>0&&($("#import_validate_div").show(),$("#import_validation_details").html(e+"/"+t),$("#validate_progressbar_done").width(o+"%"),$("#validate_progression_done").html(parseInt(o)),$("#validate_progressbar_next").width(r-o+"%")),e==t&&t==s&&$("#validate_progressbar_done").parent().removeClass("active progress-striped")}function updateProgression(e,t,s,o){var r;e>t&&(e=t),s>t&&(s=t),r=100*e/t,t>0&&($("#import_progress_div").show(),$("#import_progression_details").html(e+"/"+t),$("#import_progressbar_next").width("0%"),$("#import_progressbar_done").width(100-r+"%"),$("#import_progressbar_done2").width(r+"%"),$("#import_progressbar_done2 span").html(parseInt(r)+"%")),o&&($("#import_progressbar_done").parent().removeClass("active progress-striped"),$("#import_details_post_limit").hide(),$("#import_details_progressing").hide(),$("#import_details_finished").show(),$("#processProgress").modal({keyboard:!0,closable:!0}),$("#import_stop_button").hide(),$("#process_close_button").show())}function updateValidationError(e,t){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),t?($("#import_details_warning ul").append(e),$("#import_details_warning").show()):($("#import_details_error ul").append(e),$("#import_details_error").show(),$("#validate_progressbar_next").addClass("progress-bar-danger"),$("#validate_progressbar_next").removeClass("progress-bar-info"),$("#import_stop_button").hide(),$("#process_close_button").show())}function updateValidationInfo(e){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),$("#import_details_info ul").append(e),$("#import_details_info").show()}function updateProgressionError(e,t){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),t?($("#import_details_warning ul").append(e),$("#import_details_warning").show()):($("#import_details_error ul").append(e),$("#import_details_error").show(),$("#import_progressbar_next").addClass("progress-bar-danger"),$("#import_progressbar_next").removeClass("progress-bar-success"),$("#import_stop_button").hide(),$("#process_close_button").show())}function getSameHeightBothPanels(){var e,t;if($(".leftPanel").length>0&&$(".rightPanel").length>0)return e=$(".bootstrap .page-head").length>0?$(".bootstrap .page-head"):$("#header"),t=$(window).height()-e.height()-e.offset().top-$(".button-actions").outerHeight(!0)-($(".bootstrap .page-head").length>0?27:140),$(".rightPanel .panel, .leftPanel .panel").css("height",t+"px"),t}var productFilterTable,productsFromWarehouses,lang_datatable,mod_path,interval=0,importCancelRequest=!1,importContinueRequest=!1,data_post="",trans=new Array,url_global=window.location.href;-1!=url_global.indexOf("#")&&(url_global=url_global.split("#")[0]),$(document).ready(function(){$("body").hasClass("page-sidebar-closed")||($("body").toggleClass("page-sidebar-closed"),$(".main-menu").toggleClass("sidebar-closed")),$(".expanded").removeClass("expanded"),$("#modal-wkassignwarehouses-container").length>0&&$("body").prepend($("#modal-wkassignwarehouses-container").detach()),getSameHeightBothPanels(),$(document).on("click",".div-location, .close-form-location",function(e){e.preventDefault(),$(".div-location, .form-location").fadeOut(500)}),$(document).on("click",".edit_location, .view_warehouses, .view_stock",function(e){e.preventDefault();var t=this;id_product=$(t).closest("tr").attr("id"),template=$(t).data("target"),$(t).addClass("loading"),$(".div-location, .form-location").fadeIn(500),"view"!=template&&$(".form-location").width("700px"),$(".form-location").setCenterPositionAbsolute(),$.ajax({type:"POST",url:url_global,async:!1,cache:!1,dataType:"json",data:{ajax:1,id_product:id_product,action:"initFormLocations",template:template},success:function(e){$(t).removeClass("loading"),$(".content_form").html(e.error?e.error:e.html)}})}),$(document).on("click",".check_all_warehouses",function(e){var t,s=$('input[name*="'+$(this).val()+'"]'),o=!1;for(i=0;i<s.length;i++)(t=$(s[i])).is(":checked")?t.removeAttr("checked"):(t.attr("checked",!0),o=!0);o?$(this).find("i").removeClass("icon-check-sign").addClass("icon-check-empty"):$(this).find("i").removeClass("icon-check-empty").addClass("icon-check-sign")}),$(document).on("click","#save-locations-btn",function(e){$.ajax({type:"POST",url:url_global+"&"+$("input[class=chk_locations]").serialize()+"&"+$("input[class=input_locations]").serialize(),async:!1,cache:!1,dataType:"json",data:{ajax:1,id_product:$("#product_id").val(),action:"processWarehousesAndLocations"},success:function(e){e.error?showErrorMessage(data.error):($(".div-location, .form-location").fadeOut(500),showSuccessMessage(trans.msg_assign_success),void 0!==productsFromWarehouses&&productsFromWarehouses.draw(!1))}})}),$(document).on("click","#submit-asmqty-btn",function(){return asm_qty=$.trim($(".asm_qty").val()),isNaN(asm_qty)||""==asm_qty||0==asm_qty?(showErrorMessage(trans.txt_invalid_qty),!1):($(".div-location, .form-location").fadeOut(500),data_post="action=beginProcess&process=processAsmQuantities&"+getCheckedProductsLeft(productsFromWarehouses)+"&ids_target="+$("#ids_target").chosen().val()+"&asm_qty="+asm_qty,processNow(0,5,-1,!0),!1)}),$(document).on("click","#move_on",function(){$(this).is(":disabled")?$("input[name=transfer_qty]").attr("disabled",!0):$("input[name=transfer_qty]").removeAttr("disabled")}),$(document).on("click","#move_off",function(){$(this).is(":disabled")||($("input[id=transfer_qty_off]").attr("checked",!0),$("input[name=transfer_qty]").attr("disabled",!0))}),$(document).on("click","#use_asm_on, #use_asm_off",function(){void 0!==productsFromWarehouses&&productsFromWarehouses.draw(!1)}),$("#ids_attributes").length>0&&$("#ids_attributes").chosen({no_results_text:trans.txt_no_match_found,placeholder_text_multiple:trans.txt_select_attributes,width:"100%"}),$("#searchMode, #searchactive").chosen({disable_search:!0,width:"100%"}),$("#ids_target").length>0&&($("#ids_target").chosen({no_results_text:trans.txt_no_match_found,placeholder_text_multiple:trans.txt_select_warehouses,width:"100%"}).on("change",function(e,t){void 0!==productsFromWarehouses&&(productsFromWarehouses.draw(!1),is_filter_activated=$("#ids_target").chosen().val()>0||$("#id_brand").val()>0)}),$("#id_brand").chosen({no_results_text:trans.txt_no_match_found,placeholder_text_multiple:trans.txt_select_warehouses,width:"100%"}).on("change",function(e,t){void 0!==productsFromWarehouses&&(productsFromWarehouses.draw(!1),is_filter_activated=$("#ids_target").chosen().val()>0||$("#id_brand").val()>0)})),$(".panel-search select").chosen({width:"100%"}).on("change",function(e,t){doSearch()}),$("#productsFromFilters").length>0&&(productFilterTable=$("#productsFromFilters").DataTable({processing:!0,serverSide:!0,ajax:{url:url_global,type:"POST",data:function(e){e.ajax=1,e.action="filterProductsDatatables",e.id_warehouse=$("#id_warehouse").val(),e.id_cat=$("#id_cat").val(),e.id_manufacturer=$("#id_manufacturer").val(),e.id_supplier=$("#id_supplier").val(),e.searchMode=$("#searchMode").val(),e.search_is_active=$("#searchactive").val(),e.attributesSearch=null!=$("#ids_attributes").chosen().val()?$("#ids_attributes").chosen().val().join(","):""}},order:[[1,"asc"]],autoWidth:!1,columnDefs:[{targets:0,className:"select-checkbox"},{targets:[0,2,5,7],orderable:!1,searchable:!1},{targets:[4],orderable:!0,searchable:!1},{targets:[1,4,5,6,7],className:"dt-center"},{targets:1,name:"p.id_product"},{targets:2,name:"image",render:function(e,t,s,o){return""==e?'<img src="'+mod_path+'/views/img/no-preview.png" class="img-thumbnail">':e}},{targets:3,name:"pl.name"},{targets:4,name:"quantity",render:function(e,t,s,o){return'<span class="badge badge-'+(e>0?"success":"danger")+'">'+e+'</span> <a class="view_stock" data-target="stock"><span class="badge badge-info"><i class="icon-eye"></i></span></a>'}},{targets:5,render:function(e,t,s,o){return'<span class="badge badge-'+(e>0?"success":"danger")+'">'+e+'</span> <a class="view_warehouses" data-target="view"><span class="badge badge-info"><i class="icon-eye"></i></span></a>'}},{targets:6,render:function(e,t,s,o){return e?'<i class="icon-check"></i>':'<i class="icon-remove"></i>'}},{targets:7,render:function(e,t,s,o){return'<a href="'+e+'" title="'+trans.txt_edit+'" target="_blank" class="btn btn-default"><i class="icon-eye"></i></a>'}}],dom:'<"top">lf<"bottom"rtip><"clear">',buttons:["selectAll","selectNone"],select:{style:"multi",info:!1,selector:"td:first-child, td:last-child"},lengthMenu:[[20,50,100,250,500,1e3,2500,5e4,-1],[20,50,100,250,500,1e3,2500,5e4,trans.txt_all]],language:{url:mod_path+"/libs/datatable/"+lang_datatable+".json",searchPlaceholder:trans.txt_min_characters,sProcessing:'<i class="loading"></i>'},initComplete:function(){var e,t=$("#productsFromFilters_filter input");t.unbind(),t.bind("keyup",function(e){(this.value.length>2||""==this.value)&&productFilterTable.search(this.value).draw()}),$("#productsFromFilters").wrap('<div id="products_list"></div>'),e=getSameHeightBothPanels(),e-=$(".leftPanel .panel-heading").outerHeight()+$(".leftPanel .panel-search").outerHeight(!0)+$("#productsFromFilters_length").outerHeight(!0),e-=$(".leftPanel #productsFromFilters_info").outerHeight(!0),$containerPanel=$("#productsFromFilters").closest(".panel"),e-=parseInt($containerPanel.css("paddingTop"))+parseInt($containerPanel.css("paddingBottom")),e-=$(".leftPanel .default-option").outerHeight(!0),$("#products_list").css("height",e-9+"px")}})).on("click","th.select-checkbox",function(){$("th.select-checkbox").hasClass("selected")?(productFilterTable.rows().deselect(),$("th.select-checkbox").removeClass("selected")):(productFilterTable.rows().select(),$("th.select-checkbox").addClass("selected"))}).on("select deselect",function(){productFilterTable.rows({selected:!0}).count()!==productFilterTable.rows().count()?$("th.select-checkbox").removeClass("selected"):$("th.select-checkbox").addClass("selected")}),$("#productsFromWarehouses").length>0&&(productsFromWarehouses=$("#productsFromWarehouses").DataTable({processing:!0,serverSide:!0,ajax:{url:url_global,type:"POST",data:function(e){e.ajax=1,e.action="productsWarehousesDatatables",e.ids_target=$("#ids_target").chosen().val(),e.id_brand=$("#id_brand").chosen().val(),e.use_asm=$("#use_asm_on").is(":checked")?1:0}},order:[[1,"asc"]],autoWidth:!1,columnDefs:[{targets:0,className:"select-checkbox"},{targets:[0,2,5,7],orderable:!1,searchable:!1},{targets:[4],orderable:!0,searchable:!1},{targets:[1,4,5,6,7],className:"dt-center"},{targets:1,name:"p.id_product"},{targets:2,name:"image",render:function(e,t,s,o){return""==e?'<img src="'+mod_path+'/views/img/no-preview.png" class="img-thumbnail">':e}},{targets:3,name:"pl.name"},{targets:4,name:"quantity",render:function(e,t,s,o){return'<span class="badge badge-'+(e>0?"success":"danger")+'">'+e+'</span> <a class="view_stock" data-target="stock"><span class="badge badge-info"><i class="icon-eye"></i></span></a>'}},{targets:5,render:function(e,t,s,o){return'<span class="badge badge-'+(e>0?"success":"danger")+'">'+e+'</span> <a class="view_warehouses" data-target="view"><span class="badge badge-info"><i class="icon-eye"></i></span></a>'}},{targets:6,render:function(e,t,s,o){return e?'<i class="icon-check"></i>':'<i class="icon-remove"></i>'}},{targets:7,render:function(e,t,s,o){return'<button type="button" class="btn btn-default edit_location" data-target="edit" title="'+trans.txt_edit_locations+'"><i class="icon-home"></i></button><a href="'+e+'" title="'+trans.txt_edit+'" class="btn btn-default" target="_blank"><i class="icon-eye"></i></a>'}}],dom:'<"top">lf<"bottom"rtip><"clear">',buttons:["selectAll","selectNone"],select:{style:"multi",info:!1,selector:"td:first-child, td:last-child"},lengthMenu:[[20,50,100,250,500,1e3,2500,5e4,-1],[20,50,100,250,500,1e3,2500,5e4,trans.txt_all]],language:{url:mod_path+"/libs/datatable/"+lang_datatable+".json",searchPlaceholder:trans.txt_min_characters,sProcessing:'<i class="loading"></i>'},initComplete:function(){var e=$("#productsFromWarehouses_filter input");e.unbind(),e.bind("keyup",function(e){(this.value.length>2||""==this.value)&&productsFromWarehouses.search(this.value).draw()}),$("#productsFromWarehouses").wrap('<div id="products_warehouses"></div>'),setTimeout(function(){var e=getSameHeightBothPanels();e-=$(".rightPanel .panel-heading").outerHeight()+$(".rightPanel .panel-search").outerHeight(!0)+$("#productsFromWarehouses_length").outerHeight(!0),e-=$(".rightPanel #productsFromWarehouses_info").outerHeight(!0),$containerPanel=$("#productsFromWarehouses").closest(".panel"),e-=parseInt($containerPanel.css("paddingTop"))+parseInt($containerPanel.css("paddingBottom")),e-=$(".rightPanel .default-option").outerHeight(!0),$("#products_warehouses").css("height",e+"px")},500)}})).on("click","th.select-checkbox",function(){$("th.select-checkbox").hasClass("selected")?(productsFromWarehouses.rows().deselect(),$("th.select-checkbox").removeClass("selected")):(productsFromWarehouses.rows().select(),$("th.select-checkbox").addClass("selected"))}).on("select deselect",function(){productsFromWarehouses.rows({selected:!0}).count()!==productsFromWarehouses.rows().count()?$("th.select-checkbox").removeClass("selected"):$("th.select-checkbox").addClass("selected")}),$("#import_stop_button").unbind("click").click(function(){importContinueRequest?($("#processProgress").modal("hide"),importContinueRequest=!1,refreshDatatables()):(importCancelRequest=!0,$("#import_details_progressing").hide(),$("#import_details_finished").hide(),$("#import_details_stop").show(),$("#import_stop_button").hide(),$("#process_close_button").hide())}),$("#import_continue_button").unbind("click").click(function(){$("#import_continue_button").hide(),importContinueRequest=!1,$("#import_progress_div").show(),$("#import_details_warning ul, #import_details_info ul").html(""),$("#import_details_warning, #import_details_info").hide(),processNow(0,5,-1,!1)}),$(document).on("click",".asmStockForm",function(){var e=!1;if($element=$(this),void 0!==productsFromWarehouses&&(e=productsFromWarehouses.rows({selected:!0}).count()),!e)return showErrorMessage(trans.txt_select_product+" "+trans.txt_right_panel),!1;$.ajax({url:url_global,type:"POST",async:!1,cache:!1,dataType:"json",data:{ajax:1,action:"initFormManageStock"},beforeSend:function(){$element.addClass("loading"),$(".div-location, .form-location").fadeIn(500),$(".form-location").width("600px").setCenterPositionAbsolute()},success:function(e){$element.removeClass("loading"),$(".content_form").html(e.html)}})}),$(document).on("click",".addLoactionForm",function(){var e=!1;if($element=$(this),void 0!==productsFromWarehouses&&(e=productsFromWarehouses.rows({selected:!0}).count()),!e)return showErrorMessage(trans.txt_select_product+" "+trans.txt_right_panel),!1;$.ajax({url:url_global,type:"POST",async:!1,cache:!1,dataType:"json",data:{ajax:1,action:"initFormLocation"},beforeSend:function(){$element.addClass("loading"),$(".div-location, .form-location").fadeIn(500),$(".form-location").width("600px").setCenterPositionAbsolute()},success:function(e){$element.removeClass("loading"),$(".content_form").html(e.html)}})}),$(document).on("click","#submit-addlocation-btn",function(){return warehouse_location_label=$.trim($(".warehouse_location_label").val()),""==warehouse_location_label?(showErrorMessage(trans.txt_invalid_location),!1):($(".div-location, .form-location").fadeOut(500),data_post="action=beginProcess&process=processAddLocations&"+getCheckedProductsLeft(productsFromWarehouses)+"&ids_target="+$("#ids_target").chosen().val()+"&warehouse_location_label="+warehouse_location_label,processNow(0,5,-1,!0),!1)})}),void 0===$.fn.setCenterPositionAbsolute&&($.fn.setCenterPositionAbsolute=function(){var e=20,t=$(document).scrollTop(),s=$(this).width(),o=$(window).width();$(this).css({top:$(this).height()>$(window).height()?t+e:t+($(window).height()-$(this).height())/10,left:(o-s)/2})});